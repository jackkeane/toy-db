# Test Quick Reference

Fast reference for common testing tasks.

## Run Tests

```bash
# Full suite with reports (recommended)
python tests/run_tests.py

# All unit tests
pytest tests/unit/ -v

# All integration tests
pytest tests/integration/ -v

# All performance tests  
pytest tests/performance/ -v

# Everything with pytest
pytest tests/ -v
```

## Run Specific Tests

```bash
# Single file
pytest tests/unit/test_phase2.py -v

# Single test function
pytest tests/unit/test_phase2.py::test_btree_operations -v

# Pattern matching
pytest tests/unit/ -k "btree" -v

# Last failed only
pytest --lf

# Stop on first failure
pytest -x tests/
```

## Test Options

```bash
# Show print statements
pytest -v -s

# Full traceback
pytest --tb=long

# Short traceback (default)
pytest --tb=short

# No traceback
pytest --tb=no

# Quiet mode
pytest -q

# Show slowest 5 tests
pytest --durations=5
```

## Coverage

```bash
# Run with coverage
pytest --cov=toydb --cov-report=term

# HTML coverage report
pytest --cov=toydb --cov-report=html
open htmlcov/index.html

# Missing lines report
pytest --cov=toydb --cov-report=term-missing
```

## Reports

Generated by `python tests/run_tests.py`:

```
test_results/
├── test_report.json      # Machine-readable (CI/CD)
├── test_report.md        # Human-readable summary
├── unit_tests.json       # Unit test details
├── integration_tests.json # Integration test details
└── performance_tests.json # Performance test details
```

View reports:
```bash
# Markdown summary
cat test_results/test_report.md

# JSON stats
cat test_results/test_report.json | python -m json.tool
```

## Debugging

```bash
# Run single test with debugging
pytest tests/unit/test_phase2.py::test_btree_operations -v -s

# Add breakpoint in code
import pdb; pdb.set_trace()

# Run with pdb on failure
pytest --pdb

# Show local variables on failure
pytest -l
```

## Watch Mode

```bash
# Install pytest-watch
pip install pytest-watch

# Auto-run tests on file changes
ptw tests/unit/
```

## Quick Checks

```bash
# Syntax check all tests
python -m py_compile tests/unit/*.py

# List all tests
pytest --collect-only tests/

# Count tests
pytest --collect-only tests/ | grep "<Function" | wc -l
```

## Before Commit

```bash
# Run full suite
python tests/run_tests.py

# Check all tests pass
pytest tests/ -v

# Verify no syntax errors
python -m py_compile python/toydb/*.py
```

## Environment

```bash
# Activate environment
conda activate py312

# Install/update test deps
pip install pytest pytest-json-report pytest-cov

# Rebuild after C++ changes
pip install -e . --force-reinstall
```

## Common Issues

**Import errors:**
```bash
pip install -e .  # Rebuild project
```

**Database locked:**
```bash
rm -f test.db test.db.wal  # Clean up
```

**Cache issues:**
```bash
rm -rf .pytest_cache __pycache__  # Clear cache
```

**Stale test results:**
```bash
rm -rf test_results/  # Remove old reports
```

## CI/CD Integration

**GitHub Actions:**
```yaml
- name: Run tests
  run: python tests/run_tests.py

- name: Upload reports
  uses: actions/upload-artifact@v2
  with:
    name: test-reports
    path: test_results/
```

**GitLab CI:**
```yaml
test:
  script:
    - pip install -e .
    - python tests/run_tests.py
  artifacts:
    paths:
      - test_results/
```

## Test Statistics

Current status:
- **Total Tests:** 27
- **Pass Rate:** 96.3%
- **Avg Duration:** ~2.5s
- **Coverage:** ~83%

Track over time:
```bash
# Save stats
python tests/run_tests.py
cat test_results/test_report.json | jq '.summary' >> test_history.jsonl
```
